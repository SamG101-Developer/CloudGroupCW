<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="/static/main.css" rel="stylesheet">

    <title>VPQ</title>
</head>

<body>
    <div id="game">
        <div v-if="connected">
            <%- include('friends'); -%>
<!--            <div>-->
<!--                <input type="text" @keyup.enter="chat()" v-model="chatmessage" class="form-control" placeholder="Chat">-->
<!--                <ul id="chat">-->
<!--                    <li v-for="message in messages">{{message}}</li>-->
<!--                </ul>-->
<!--            </div>-->

        </div>
        <div v-else>
            <p>Connecting...</p>
        </div>

<!--        <div class="login-container">-->
<!--            <h2 style="grid-column: 1 / -1;">Virtual Pub Quiz</h2>-->
<!--            <input style="grid-column: 1 / -1;" type="text" v-model="loginInput.username" placeholder="Username">-->
<!--            <input style="grid-column: 1 / -1;" type="password" v-model="loginInput.password" placeholder="Password">-->
<!--            <button @click="register">Register</button>-->
<!--            <button @click="login">Login</button>-->
<!--        </div>-->
    </div>
    <!-- Bootstrap Javascript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <!-- SocketIO -->
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js" integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs" crossorigin="anonymous"></script>

    <!-- VueJS -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <!-- Application Javascript -->
    <script type=module src="/static/client.js"></script>

    <script src="/static/scripts/createQuizTabs.js"></script>

    <script>
        function createQuiz(username) {

            let quizJSON = { author: username, questions: [] };

            let quizName = prompt("Enter the name of your quiz");
            let roundContent = document.getElementById("round-content");
            let rounds = roundContent.children;

            for (let round of rounds) {
                quizJSON.questions.push(parseRound(round, username));
            }

            window.app.createQuiz(quizJSON);
        }

        function parseRound(round, username) {
            let questionSetRound = [];
            let roundComponents = round.children;
            for (let roundComponent of roundComponents) {
                if (!roundComponent.classList.contains("questionTemplate")) continue;
                questionSetRound.push(parseQuestion(roundComponent, username));
            }
            return questionSetRound;
        }

        function parseQuestion(roundComponent, username) {
            let question = {
                author: username,
                question: "",
                answers: [],
                correct_answer: "",
                question_type: ""
            }

            // Parse the question type
            roundComponent.querySelectorAll(".checkbox-row > .checkbox-row").forEach(questionType => {
                if (questionType.querySelector("input").checked) {
                    console.log(true);
                    question["question_type"] = questionType.querySelector("label").innerHTML;
                }
            })

            // Parse the question text
            question["question"] = roundComponent.querySelector(".QuestionInput").value

            // Parse the answers
            if (question["question_type"] === "Multiple Choice"){
                roundComponent.querySelectorAll(".multipleChoiceOptionsContainer > .checkbox-row").forEach(option => {
                    let answer = option.querySelector("input[type=text]").value;
                    question["answers"].push(answer)

                    let checkbox = option.querySelector("input[type=radio]");

                    if (checkbox.checked){
                        question["correct_answer"] = answer;
                    }
                })
            }else{
                question["correct_answer"] = roundComponent.querySelector(".AnswerInput").value
            }
            return question;
        }
    </script>

</body>

</html>
